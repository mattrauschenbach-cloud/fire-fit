import { useEffect, useState } from 'react'
import { db } from '../lib/firebase'
import { doc, getDoc, setDoc } from 'firebase/firestore'
import { useAuthState } from '../lib/auth'
export default function Monthly(){const{profile}=useAuthState();const isMentor=profile?.role==='mentor';const[month,setMonth]=useState('');const[title,setTitle]=useState('');const[details,setDetails]=useState('');const[movements,setMovements]=useState(['']);const[msg,setMsg]=useState('')
useEffect(()=>{(async()=>{const s=await getDoc(doc(db,'meta','monthly'));if(s.exists()){const d=s.data();setMonth(d.month||'');setTitle(d.title||'');setDetails(d.details||'');setMovements(Array.isArray(d.movements)?d.movements:[])}})()},[])
const save=async(e)=>{e.preventDefault();if(!isMentor)return;await setDoc(doc(db,'meta','monthly'),{month,title,details,movements:movements.filter(Boolean)},{merge:true});setMsg('Saved ✓')}
return(<section className="space-y-4"><h2 className="text-2xl font-bold">Monthly Workout</h2><div className="bg-white border rounded-xl p-4 space-y-2"><div className="text-sm text-slate-500">Month</div><div className="text-lg font-semibold">{month||'—'}</div><div className="text-sm text-slate-500">Title</div><div className="text-lg font-semibold">{title||'—'}</div><p className="text-slate-700">{details||'—'}</p>{movements?.length?<ul className="list-disc pl-6">{movements.map((m,i)=><li key={i}>{m}</li>)}</ul>:<p className="text-sm text-slate-500">No movements yet.</p>}</div>{isMentor&&(<form onSubmit={save} className="space-y-3 max-w-xl"><input className="w-full border rounded px-3 py-2" placeholder="YYYY-MM" value={month} onChange={e=>setMonth(e.target.value)}/><input className="w-full border rounded px-3 py-2" placeholder="Title" value={title} onChange={e=>setTitle(e.target.value)}/><textarea className="w-full border rounded px-3 py-2" rows="3" placeholder="Details" value={details} onChange={e=>setDetails(e.target.value)}/><button className="px-3 py-2 rounded bg-slate-900 text-white">Save</button>{msg&&<span className="text-sm text-slate-600 ml-2">{msg}</span>}</form>)}</section>)}
